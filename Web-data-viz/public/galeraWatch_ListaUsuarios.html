<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galerawatch • Usuários</title>

    <link rel="stylesheet" href="./css/styleGaleraWatchUsuarios.css">
    <link rel="icon" href="./assets/icon/coracaovGalerawatch.png" />

    <script src="./js/sessao.js"></script>
</head>

<body onload="listarUsuarios()">

    <div class="header">

        <div class="informacoesUsuario">

            <div id="div_perfilUsuario">
                <div id="iconePersonagem">

                </div>
                <div>
                    Apelido: <span id="span_nomeUsuario"></span>
                    <br>
                    Funcões: <span id="span_funcoes"></span>
                    <br>
                    Personagens: <span id="span_personagens"></span>
                    <br>
                </div>
            </div>
            <span id="span_mensagem">Lorem ipsum dolor sit amet consectetur adipisicing elit. Ex voluptatibus iure
                consequuntur abcdefga</span>
        </div>

        <div class="menu">

            <a href="galeraWatch.html">PÁGINA INICIAL</a>
            <a href="galeraWatch_ListaUsuarios.html">USUÁRIOS</a>
            <a href="galeraWatch_Dashboard.html">DASHBOARD</a>
            <a onclick="limparSessao()">SAIR</a>

        </div>
    </div>

    <div class="containerConteudo">

        <table id="div_mostrarPerfis">
            <tr>
                <th class="colunaNome">NOME</th>
                <th class="colunaPersonagem">PERSONAGENS</th>
                <th class="colunaFuncao">FUNÇÕES</th>
                <th class="colunaMensagem">MENSAGEM</th>
            </tr>

            <!-- <tr>
                <td class="colunaNome dadosNome">
                    <div class="personagem"></div>
                    <span class="nome_usuario">${dados.nome}</span>
                </td>
                <td class="colunaPersonagem">
                    ${dados.personagem1}, ${dados.personagem2}, ${dados.personagem3}
                    <div class="personagem"></div>
                    <div class="personagem"></div>
                    <div class="personagem"></div>
                </td>
                <td class="colunaFuncao campoFuncao">
                    ${dados.funcao}

                </td>
                <td class="colunaMensagem campoMensagem">
                    <span>${dados.mensagem}</span>
                </td>
            </tr> -->

        </table>

    </div>

</body>

</html>

<script>

    const listaPersonagensUsuario = [];

    listaPersonagensUsuario.push(sessionStorage.PERSONAGEM1_USUARIO);
    listaPersonagensUsuario.push(' ' + sessionStorage.PERSONAGEM2_USUARIO);
    listaPersonagensUsuario.push(' ' + sessionStorage.PERSONAGEM3_USUARIO);

    span_nomeUsuario.innerHTML = sessionStorage.NOME_USUARIO;
    span_funcoes.innerHTML = sessionStorage.FUNCAO_USUARIO;
    span_personagens.innerHTML = listaPersonagensUsuario;
    span_mensagem.innerHTML = sessionStorage.MENSAGEM_USUARIO;


    const listaNomesPersonagens = ['D.Va', 'Doomfist', 'Junker Queen', 'Mauga', 'Orisa', 'Ramattra', 'Reinhardt', 'Roadhog', 'Sigma', 'Winston', 'Wrecking Ball', 'Zarya', 'Ashe', 'Bastion', 'Cassidy', 'Echo', 'Genji', 'Hanzo', 'Junkrat', 'Mei', 'Pharah', 'Reaper', 'Sojourn', 'Soldado: 76', 'Sombra', 'Symmetra', 'Torbjörn', 'Tracer', 'Venture', 'Widowmaker', 'Ana', 'Baptiste', 'Brigitte', 'Illari', 'Kiriko', 'Lifeweaver', 'Lúcio', 'Mercy', 'Moira', 'Zenyatta'];

    const listaImagensPersonagens = ['https://abre.ai/imagemdva', 'https://abre.ai/imagemdoomfist', 'https://abre.ai/imagemjunkerqueen', 'https://abre.ai/imagemmauga', 'https://abre.ai/imagemorisa', 'https://abre.ai/imagemramattra', 'https://abre.ai/imagemreinhardt', 'https://abre.ai/imagemroadhog', 'https://abre.ai/imagemsigma', 'https://abre.ai/imagemwinston', 'https://abre.ai/imagemwreckingball', 'https://abre.ai/imagemzarya', 'https://abre.ai/imagemashe', 'https://abre.ai/imagembastion', 'https://abre.ai/imagemcassidy', 'https://abre.ai/imagemecho', 'https://abre.ai/imagemgenji', 'https://abre.ai/imagemhanzo', 'https://abre.ai/imagemjunkrat', 'https://abre.ai/imagemmei', 'https://abre.ai/imagemphara', 'https://abre.ai/imagemreaper', 'https://abre.ai/imagemsojourn', 'https://abre.ai/imagemsoldado76', 'https://abre.ai/imagemsombra', 'https://abre.ai/imagemsymmetra', 'https://abre.ai/imagemtorbjorn', 'https://abre.ai/imagemtracer', 'https://abre.ai/imagemventure', 'https://abre.ai/imagemwidowmaker', 'https://abre.ai/imagemana', 'https://abre.ai/imagembaptiste', 'https://abre.ai/imagembrigitte', 'https://abre.ai/imagemillari', 'https://abre.ai/imagemkiriko', 'https://abre.ai/imagemlifeweaver', 'https://abre.ai/imagemlucio', 'https://abre.ai/imagemmercy', 'https://abre.ai/imagemmoira', 'https://abre.ai/imagemzenyatta'];

    for (let contador = 0; contador < listaNomesPersonagens.length; contador++) {

        if (listaNomesPersonagens[contador] == sessionStorage.PERSONAGEM1_USUARIO) {

            iconePersonagem.style.backgroundImage = `url('${listaImagensPersonagens[contador]}'`;

            break;

        }

    }


    function listarUsuarios() {
        fetch("/usuarios/listarUsuarios").then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("div_mostrarPerfis");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    for (let i = 0; i < resposta.length; i++) {
                        var dados = resposta[i];

                        const listaFuncoes = dados.funcao.split(",", 2);

                        div_mostrarPerfis.innerHTML += `
                                            <tr>
                                                <td class="colunaNome dadosNome">
                                                    <div class="personagem" id='personagem1_perfilUsuario${i}'></div>
                                                    <span class="nome_usuario">${dados.nome}</span>
                                                </td>
                                                <td class="colunaPersonagem">
                                                    <div class="personagem" id='personagem1_usuario${i}'></div>
                                                    <div class="personagem" id='personagem2_usuario${i}'></div>
                                                    <div class="personagem" id='personagem3_usuario${i}'></div>
                                                </td>
                                                <td class="colunaFuncao campoFuncao">
                                                    <img src="../assets/Tanque_icon.png" class="icone" id="funcaoTanqueUsuario${[i]}">
                    <img src="../assets/Dano_icon.png" class="icone" id="funcaoDanoUsuario${[i]}">
                    <img src="../assets/Suporte_icon.png" class="icone" id="funcaoSuporteUsuario${[i]}">
                    <img src="../assets/Todos_icon.png" class="icone" id="funcaoTodosUsuario${[i]}">
                                                        </td>
                                                        <td class="colunaMensagem campoMensagem">
                                                            <span>${dados.mensagem}</span>
                                                        </td>
                                                    </tr>`

                        for (let contador = 0; contador < listaNomesPersonagens.length; contador++) {

                            let idPersonagem1PerfilUsuario = document.getElementById(`personagem1_perfilUsuario${i}`);
                            let idPersonagem1Usuario = document.getElementById(`personagem1_usuario${i}`);
                            let idPersonagem2Usuario = document.getElementById(`personagem2_usuario${i}`);
                            let idPersonagem3Usuario = document.getElementById(`personagem3_usuario${i}`);

                            if (listaNomesPersonagens[contador] == dados.personagem1) {

                                idPersonagem1PerfilUsuario.style.backgroundImage = `url('${listaImagensPersonagens[contador]}'`;

                            }

                            if (listaNomesPersonagens[contador] == dados.personagem1) {

                                idPersonagem1Usuario.style.backgroundImage = `url('${listaImagensPersonagens[contador]}'`;

                            }

                            if (listaNomesPersonagens[contador] == dados.personagem2) {

                                idPersonagem2Usuario.style.backgroundImage = `url('${listaImagensPersonagens[contador]}'`;

                            }

                            if (listaNomesPersonagens[contador] == dados.personagem3) {

                                idPersonagem3Usuario.style.backgroundImage = `url('${listaImagensPersonagens[contador]}'`;

                            }

                        }

                        for (let contadorFuncoes = 0; contadorFuncoes < listaFuncoes.length; contadorFuncoes++) {

                            let idFuncaoTanque = document.getElementById(`funcaoTanqueUsuario${[i]}`);
                            let idFuncaoDano = document.getElementById(`funcaoDanoUsuario${[i]}`);
                            let idFuncaoSuporte = document.getElementById(`funcaoSuporteUsuario${[i]}`);
                            let idFuncaoTodos = document.getElementById(`funcaoTodosUsuario${[i]}`);

                            if (listaFuncoes[contadorFuncoes] == 'Tanque') {

                                idFuncaoTanque.style.display = 'block';

                            }

                            if (listaFuncoes[contadorFuncoes] == 'Dano') {

                                idFuncaoDano.style.display = 'block';

                            }

                            if (listaFuncoes[contadorFuncoes] == 'Suporte') {

                                idFuncaoSuporte.style.display = 'block';

                            }

                            if (listaFuncoes[contadorFuncoes] == 'Todos') {

                                idFuncaoTodos.style.display = 'block';

                            }

                        }

                    }
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });
    }

</script>