<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="./css/styleCadastroPersonagem.css">
    <link rel="icon" href="./assets/icon/coracaovGalerawatch.png" />

</head>

<body onload="carregarCardsPersonagens()">

    <div class="containerBotao">
        <div class="topBotao">
            <div id="containerIcone">

            </div>
            <span id="funcoes">

            </span>
        </div>
        <button onclick="salvarCadastrarPersonagens()" class="botao">CONTINUAR</button>
    </div>

    <span class="titulo">SELECIONE 3 PERSONAGENS</span>

    <div id="containerPersonagens">

        <div id="containerTanque">

        </div>

        <div id="containerDano">

        </div>

        <div id="containerSuporte">

        </div>

    </div>

</body>

</html>

<script>

    let qtdPersonagensChecked = 0;

    const listaNomesPersonagensTanque = ['D.Va', 'Doomfist', 'Junker Queen', 'Mauga', 'Orisa', 'Ramattra', 'Reinhardt', 'Roadhog', 'Sigma', 'Winston', 'Wrecking Ball', 'Zarya'];
    const listaNomesPersonagensTanqueParaID = ['dva', 'doomfist', 'junkerQueen', 'mauga', 'orisa', 'ramattra', 'reinhardt', 'roadhog', 'sigma', 'winston', 'wreckingBall', 'zarya'];
    const listaImagensPersonagensTanque = ['https://abre.ai/imagemdva', 'https://abre.ai/imagemdoomfist', 'https://abre.ai/imagemjunkerqueen', 'https://abre.ai/imagemmauga', 'https://abre.ai/imagemorisa', 'https://abre.ai/imagemramattra', 'https://abre.ai/imagemreinhardt', 'https://abre.ai/imagemroadhog', 'https://abre.ai/imagemsigma', 'https://abre.ai/imagemwinston', 'https://abre.ai/imagemwreckingball', 'https://abre.ai/imagemzarya'];

    const listaNomesPersonagensDano = ['Ashe', 'Bastion', 'Cassidy', 'Echo', 'Genji', 'Hanzo', 'Junkrat', 'Mei', 'Pharah', 'Reaper', 'Sojourn', 'Soldado: 76', 'Sombra', 'Symmetra', 'Torbjörn', 'Tracer', 'Venture', 'Widowmaker'];
    const listaNomesPersonagensDanoParaID = ['ashe', 'bastion', 'cassidy', 'echo', 'genji', 'hanzo', 'junkrat', 'mei', 'pharah', 'reaper', 'sojourn', 'soldado76', 'sombra', 'symmetra', 'torbjorn', 'tracer', 'venture', 'widowmaker'];
    const listaImagensPersonagensDano = ['https://abre.ai/imagemashe', 'https://abre.ai/imagembastion', 'https://abre.ai/imagemcassidy', 'https://abre.ai/imagemecho', 'https://abre.ai/imagemgenji', 'https://abre.ai/imagemhanzo', 'https://abre.ai/imagemjunkrat', 'https://abre.ai/imagemmei', 'https://abre.ai/imagemphara', 'https://abre.ai/imagemreaper', 'https://abre.ai/imagemsojourn', 'https://abre.ai/imagemsoldado76', 'https://abre.ai/imagemsombra', 'https://abre.ai/imagemsymmetra', 'https://abre.ai/imagemtorbjorn', 'https://abre.ai/imagemtracer', 'https://abre.ai/imagemventure', 'https://abre.ai/imagemwidowmaker'];

    const listaNomesPersonagensSuporte = ['Ana', 'Baptiste', 'Brigitte', 'Illari', 'Kiriko', 'Lifeweaver', 'Lúcio', 'Mercy', 'Moira', 'Zenyatta'];
    const listaNomesPersonagensSuporteParaID = ['ana', 'baptiste', 'brigitte', 'illari', 'kiriko', 'lifeweaver', 'lucio', 'mercy', 'moira', 'zenyatta'];
    const listaImagensPersonagensSuporte = ['https://abre.ai/imagemana', 'https://abre.ai/imagembaptiste', 'https://abre.ai/imagembrigitte', 'https://abre.ai/imagemillari', 'https://abre.ai/imagemkiriko', 'https://abre.ai/imagemlifeweaver', 'https://abre.ai/imagemlucio', 'https://abre.ai/imagemmercy', 'https://abre.ai/imagemmoira', 'https://abre.ai/imagemzenyatta'];

    const listaPersonagensEscolhidos = [];
    let [personagem1, personagem2, personagem3] = listaPersonagensEscolhidos;

    function carregarCardsPersonagens() {

        for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensTanque.length; contadorPosicao++) {

            const nomePersonagem = listaNomesPersonagensTanque[contadorPosicao];
            const nomePersonagemID = listaNomesPersonagensTanqueParaID[contadorPosicao];
            const linkImagemPersonagem = listaImagensPersonagensTanque[contadorPosicao];

            containerTanque.innerHTML += `<div class="cardPersonagem" id="div_${nomePersonagemID}" style="background-image: url(${linkImagemPersonagem});">
            <input type="checkbox" id="check_${nomePersonagemID}" class="check" onclick="verificarCheckTodos()">
            <span>${nomePersonagem.toUpperCase()}</span>
            </div>`;

        }

        for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensDano.length; contadorPosicao++) {

            const nomePersonagem = listaNomesPersonagensDano[contadorPosicao];
            const nomePersonagemID = listaNomesPersonagensDanoParaID[contadorPosicao];
            const linkImagemPersonagem = listaImagensPersonagensDano[contadorPosicao];

            containerDano.innerHTML += `<div class="cardPersonagem" id="div_${nomePersonagemID}" style="background-image: url(${linkImagemPersonagem});">
            <input type="checkbox" id="check_${nomePersonagemID}" class="check" onclick="verificarCheckTodos()">
            <span>${nomePersonagem.toUpperCase()}</span>
            </div>`;

        }

        for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensSuporte.length; contadorPosicao++) {

            const nomePersonagem = listaNomesPersonagensSuporte[contadorPosicao];
            const nomePersonagemID = listaNomesPersonagensSuporteParaID[contadorPosicao];
            const linkImagemPersonagem = listaImagensPersonagensSuporte[contadorPosicao];

            containerSuporte.innerHTML += `<div class="cardPersonagem" id="div_${nomePersonagemID}" style="background-image: url(${linkImagemPersonagem});">
            <input type="checkbox" id="check_${nomePersonagemID}" class="check" onclick="verificarCheckTodos()">
            <span>${nomePersonagem.toUpperCase()}</span>
            </div>`;

        }

        mostrarFuncaoEscolhida();

    }

    function mostrarFuncaoEscolhida() {

        const funcaoEscolhida = sessionStorage.FUNCAO_USUARIO.split(",", 2);

        for (contadorFuncoes = 0; contadorFuncoes < funcaoEscolhida.length; contadorFuncoes++) {

            if (contadorFuncoes >= 1) {

                funcoes.innerHTML += ', ';

            }

            if (funcaoEscolhida[contadorFuncoes] == 'Tanque') {

                containerIcone.innerHTML = `<img src="../assets/Tank_icon.png" alt="" class="icone">`;
                funcoes.innerHTML = `TANQUE`;

            } else if (funcaoEscolhida[contadorFuncoes] == 'Dano') {

                containerIcone.innerHTML += `<img src="../assets/Damage_icon.png" alt="" class="icone">`;
                funcoes.innerHTML += `DANO`;
                
            } else if (funcaoEscolhida[contadorFuncoes] == 'Suporte') {
                
                containerIcone.innerHTML += `<img src="../assets/Support_icon.png" alt="" class="icone">`;
                funcoes.innerHTML += `SUPORTE`;
                
            } else if (funcaoEscolhida[contadorFuncoes] == 'Todos') {
                
                containerIcone.innerHTML = `<img src="../assets/All_icon.png" alt="" class="icone">`;
                funcoes.innerHTML = `TODOS`;

            }

        }


    }

    function verificarCheckTodos() {

        qtdPersonagensChecked = 0;

        for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensTanque.length; contadorPosicao++) {

            const nomePersonagemID = listaNomesPersonagensTanqueParaID[contadorPosicao];
            const divPersonagem = document.getElementById(`div_${nomePersonagemID}`);
            const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

            if (checkPersonagem.checked) {

                qtdPersonagensChecked++;

                divPersonagem.style.boxShadow = `0px 0px 15px #b50000`;
                divPersonagem.style.transform = `scale(1.07)`;
                
            } else {
                
                divPersonagem.style.boxShadow = 'none';
                divPersonagem.style.transform = `scale(1)`;

            }

        }

        for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensDano.length; contadorPosicao++) {

            const nomePersonagemID = listaNomesPersonagensDanoParaID[contadorPosicao];
            const divPersonagem = document.getElementById(`div_${nomePersonagemID}`);
            const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

            if (checkPersonagem.checked) {

                qtdPersonagensChecked++;

                divPersonagem.style.boxShadow = `0px 0px 15px #b50000`;
                divPersonagem.style.transform = `scale(1.07)`;

            } else {

                divPersonagem.style.boxShadow = 'none';
                divPersonagem.style.transform = `scale(1)`;

            }

        }

        for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensSuporte.length; contadorPosicao++) {

            const nomePersonagemID = listaNomesPersonagensSuporteParaID[contadorPosicao];
            const divPersonagem = document.getElementById(`div_${nomePersonagemID}`);
            const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

            if (checkPersonagem.checked) {

                qtdPersonagensChecked++;

                divPersonagem.style.boxShadow = `0px 0px 15px #b50000`;
                divPersonagem.style.transform = `scale(1.07)`;

            } else if (!checkPersonagem.checked) {

                divPersonagem.style.boxShadow = 'none';
                divPersonagem.style.transform = `scale(1)`;

            }

        }

        if (qtdPersonagensChecked == 3) {

            for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensTanque.length; contadorPosicao++) {
                const nomePersonagemID = listaNomesPersonagensTanqueParaID[contadorPosicao];
                const divPersonagem = document.getElementById(`div_${nomePersonagemID}`);
                const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

                if (!checkPersonagem.checked) {

                    checkPersonagem.disabled = true;

                    divPersonagem.style.backgroundImage = `linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url('${listaImagensPersonagensTanque[contadorPosicao]}')`;

                }
            }

            for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensDano.length; contadorPosicao++) {
                const nomePersonagemID = listaNomesPersonagensDanoParaID[contadorPosicao];
                const divPersonagem = document.getElementById(`div_${nomePersonagemID}`);
                const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

                if (!checkPersonagem.checked) {

                    checkPersonagem.disabled = true;

                    divPersonagem.style.backgroundImage = `linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url('${listaImagensPersonagensDano[contadorPosicao]}')`;

                }

            }

            for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensSuporte.length; contadorPosicao++) {
                const nomePersonagemID = listaNomesPersonagensSuporteParaID[contadorPosicao];
                const divPersonagem = document.getElementById(`div_${nomePersonagemID}`);
                const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

                if (!checkPersonagem.checked) {

                    checkPersonagem.disabled = true;

                    divPersonagem.style.backgroundImage = `linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url('${listaImagensPersonagensSuporte[contadorPosicao]}')`;


                }

            }

        } else {

            for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensTanque.length; contadorPosicao++) {
                const nomePersonagemID = listaNomesPersonagensTanqueParaID[contadorPosicao];
                const divPersonagem = document.getElementById(`div_${nomePersonagemID}`);
                const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

                checkPersonagem.disabled = false;

                divPersonagem.style.backgroundImage = `url('${listaImagensPersonagensTanque[contadorPosicao]}')`;

            }

            for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensDano.length; contadorPosicao++) {
                const nomePersonagemID = listaNomesPersonagensDanoParaID[contadorPosicao];
                const divPersonagem = document.getElementById(`div_${nomePersonagemID}`);
                const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

                checkPersonagem.disabled = false;

                divPersonagem.style.backgroundImage = `url('${listaImagensPersonagensDano[contadorPosicao]}')`;

            }

            for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensSuporte.length; contadorPosicao++) {
                const nomePersonagemID = listaNomesPersonagensSuporteParaID[contadorPosicao];
                const divPersonagem = document.getElementById(`div_${nomePersonagemID}`);
                const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

                checkPersonagem.disabled = false;

                divPersonagem.style.backgroundImage = `url('${listaImagensPersonagensSuporte[contadorPosicao]}')`;

            }

        }

    }

    function salvarCadastrarPersonagens() {

        if (qtdPersonagensChecked < 3) {

            alert("Selecione três personagens!");

        } else {

            for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensTanque.length; contadorPosicao++) {

                const nomePersonagemID = listaNomesPersonagensTanqueParaID[contadorPosicao];
                const nomePersonagem = listaNomesPersonagensTanque[contadorPosicao];
                const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

                if (checkPersonagem.checked) {

                    listaPersonagensEscolhidos.push(nomePersonagem);

                }

            }

            for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensDano.length; contadorPosicao++) {

                const nomePersonagemID = listaNomesPersonagensDanoParaID[contadorPosicao];
                const nomePersonagem = listaNomesPersonagensDano[contadorPosicao];
                const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

                if (checkPersonagem.checked) {

                    listaPersonagensEscolhidos.push(nomePersonagem);

                }

            }

            for (let contadorPosicao = 0; contadorPosicao < listaNomesPersonagensSuporte.length; contadorPosicao++) {

                const nomePersonagemID = listaNomesPersonagensSuporteParaID[contadorPosicao];
                const nomePersonagem = listaNomesPersonagensSuporte[contadorPosicao];
                const checkPersonagem = document.getElementById(`check_${nomePersonagemID}`);

                if (checkPersonagem.checked) {

                    listaPersonagensEscolhidos.push(nomePersonagem);

                }

            }

            [personagem1, personagem2, personagem3] = listaPersonagensEscolhidos;

            console.log(listaPersonagensEscolhidos);
            console.log(personagem1);
            console.log(personagem2);
            console.log(personagem3);


            guardarBanco();
        }

    }

    function guardarBanco() {

        fetch(`/personagens/cadastrarPersonagens`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                personagem1Server: personagem1,
                personagem2Server: personagem2,
                personagem3Server: personagem3,
                idUsuario: sessionStorage.getItem("ID_USUARIO")
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    setTimeout(() => {
                        window.location = "cadastroDescricao.html";
                    }, "2000");

                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

        return false;
    }

</script>