<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="css/styleCadastroDescricao.css">

    <script src="./js/sessao.js"></script>
</head>

<body>

    <div class="titulo">
        <h2>Quase lá!</h2>
        <div class="containerProgresso">
            <div class="containerBarra">
                <p>Progresso: <span>90%</span></p>
                <div class="cinza">
                    <div class="branco">
                        <div class="verde">
                            <img src="../../Imagens/setaDupla.png" alt="">
                        </div>
                    </div>
                </div>
            </div>
            <img src="../../Imagens/LogoGaleraWatch.png" alt="">
        </div>
        <div class="legendaProgresso">
            <div class="containerProgresso2">
                Função
                <div class="bolinha">
                    <img src="../../Imagens/seta.png" alt="">
                </div>
            </div>

            <div class="containerProgresso2">
                Personagens
                <div class="bolinha">
                    <img src="../../Imagens/seta.png" alt="">
                </div>
            </div>
        </div>
    </div>

    <input type="text" id="input_descricao" placeholder="Escreva uma mensagem para as pessoas saberem que tipo de pessoa você é!">

    <button class="botao" onclick="validarDescricao()">FINALIZAR</button>

</body>

</html>

<script>

    function validarDescricao() {

        const descricao = input_descricao.value;

        if (descricao.length <= 0) {

            alert('Para de ser antisocial');

        } else {

            guardarBanco();

        }

    }

    function guardarBanco() {

        const descricao = input_descricao.value;

        fetch(`/personagens/cadastrarDescricao`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                descricaoServer: descricao,
                idUsuario: sessionStorage.getItem("ID_USUARIO")
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    setTimeout(() => {
                        limparSessao();
                    }, "2000");

                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

        return false;
    }

</script>